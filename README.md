# Express.js –ø—Ä–æ–µ–∫—Ç –∑ PUG/EJS, Cookies —Ç–∞ JWT

## üöÄ –®–≤–∏–¥–∫–∏–π —Å—Ç–∞—Ä—Ç

### –í—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–Ω—è –∑–∞–ª–µ–∂–Ω–æ—Å—Ç–µ–π
```bash
npm install
```

### –ó–∞–ø—É—Å–∫ —Å–µ—Ä–≤–µ—Ä–∞
```bash
node index.js
```

–°–µ—Ä–≤–µ—Ä –∑–∞–ø—É—Å—Ç–∏—Ç—å—Å—è –Ω–∞ `http://localhost:3000`

## üìã –†–µ–∞–ª—ñ–∑–æ–≤–∞–Ω—ñ —Ñ—É–Ω–∫—Ü—ñ—ó

### ‚úÖ 1. –°—Ç–∞—Ç–∏—á–Ω—ñ —Ñ–∞–π–ª–∏ —Ç–∞ Favicon
- ‚úì –ù–∞–ª–∞—à—Ç–æ–≤–∞–Ω–æ Express –¥–ª—è –æ–±—Å–ª—É–≥–æ–≤—É–≤–∞–Ω–Ω—è —Å—Ç–∞—Ç–∏—á–Ω–∏—Ö —Ñ–∞–π–ª—ñ–≤ –∑ –ø–∞–ø–∫–∏ `public`
- ‚úì Favicon –¥–æ—Å—Ç—É–ø–Ω–∏–π –∑–∞ –∞–¥—Ä–µ—Å–æ—é `/img/favicon.ico`
- ‚úì –í—Å—ñ —à–∞–±–ª–æ–Ω–∏ PUG —Ç–∞ EJS –º—ñ—Å—Ç—è—Ç—å —Ç–µ–≥ `<link rel="icon" href="/img/favicon.ico">`

### ‚úÖ 2. –†–æ–±–æ—Ç–∞ –∑ Cookies - –ó–±–µ—Ä–µ–∂–µ–Ω–Ω—è —Ç–µ–º–∏ –æ—Ñ–æ—Ä–º–ª–µ–Ω–Ω—è
- ‚úì **POST /set-theme** - –ó–±–µ—Ä–µ–∂–µ–Ω–Ω—è —É–ª—é–±–ª–µ–Ω–æ—ó —Ç–µ–º–∏ –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–∞ (light/dark/auto)
- ‚úì **GET /get-theme** - –û—Ç—Ä–∏–º–∞–Ω–Ω—è –ø–æ—Ç–æ—á–Ω–æ—ó —Ç–µ–º–∏
- ‚úì –í–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—î—Ç—å—Å—è `cookie-parser` middleware
- ‚úì Cookie –∑–±–µ—Ä—ñ–≥–∞—î—Ç—å—Å—è –Ω–∞ 30 –¥–Ω—ñ–≤

### ‚úÖ 3. JWT Authentication
- ‚úì **POST /register** - –†–µ—î—Å—Ç—Ä–∞—Ü—ñ—è –Ω–æ–≤–æ–≥–æ –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–∞
- ‚úì **POST /login** - –í—Ö—ñ–¥ –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–∞ –∑ –≥–µ–Ω–µ—Ä–∞—Ü—ñ—î—é JWT —Ç–æ–∫–µ–Ω—É
- ‚úì **POST /logout** - –í–∏—Ö—ñ–¥ –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–∞ (–æ—á–∏—â–µ–Ω–Ω—è cookie)
- ‚úì JWT —Ç–æ–∫–µ–Ω–∏ –∑–±–µ—Ä—ñ–≥–∞—é—Ç—å—Å—è –≤ `httpOnly` cookies –¥–ª—è –±–µ–∑–ø–µ–∫–∏
- ‚úì –¢–µ—Ä–º—ñ–Ω –¥—ñ—ó —Ç–æ–∫–µ–Ω—É: 24 –≥–æ–¥–∏–Ω–∏
- ‚úì –ó–∞—Ö–∏—Å—Ç –≤—ñ–¥ XSS —Ç–∞ CSRF –∞—Ç–∞–∫

### ‚úÖ 4. –ó–∞—Ö–∏—â–µ–Ω—ñ –º–∞—Ä—à—Ä—É—Ç–∏
- ‚úì **GET /profile** - –ó–∞—Ö–∏—â–µ–Ω–∏–π –º–∞—Ä—à—Ä—É—Ç (–ø–æ—Ç—Ä—ñ–±–Ω–∞ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü—ñ—è)
- ‚úì **GET /auth-status** - –ü–µ—Ä–µ–≤—ñ—Ä–∫–∞ —Å—Ç–∞—Ç—É—Å—É –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü—ñ—ó
- ‚úì Middleware `authenticateJWT` –¥–ª—è –ø–µ—Ä–µ–≤—ñ—Ä–∫–∏ —Ç–æ–∫–µ–Ω—ñ–≤

### ‚úÖ 5. –Ü—Å–Ω—É—é—á—ñ –º–∞—Ä—à—Ä—É—Ç–∏
- ‚úì **GET /users** - –°–ø–∏—Å–æ–∫ –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á—ñ–≤ (PUG —à–∞–±–ª–æ–Ω)
- ‚úì **GET /users/:id** - –ö–æ—Ä–∏—Å—Ç—É–≤–∞—á –∑–∞ ID (PUG —à–∞–±–ª–æ–Ω)
- ‚úì **GET /articles** - –°–ø–∏—Å–æ–∫ —Å—Ç–∞—Ç–µ–π (EJS —à–∞–±–ª–æ–Ω)
- ‚úì **GET /articles/:id** - –°—Ç–∞—Ç—Ç—è –∑–∞ ID (EJS —à–∞–±–ª–æ–Ω)

## üß™ –¢–µ—Å—Ç—É–≤–∞–Ω–Ω—è

### –í–µ–±-—ñ–Ω—Ç–µ—Ä—Ñ–µ–π—Å –¥–ª—è —Ç–µ—Å—Ç—É–≤–∞–Ω–Ω—è
–í—ñ–¥–∫—Ä–∏–π—Ç–µ —É –±—Ä–∞—É–∑–µ—Ä—ñ: `http://localhost:3000/test.html`

–¶—è —Å—Ç–æ—Ä—ñ–Ω–∫–∞ –º—ñ—Å—Ç–∏—Ç—å —ñ–Ω—Ç–µ—Ä–∞–∫—Ç–∏–≤–Ω–∏–π —ñ–Ω—Ç–µ—Ä—Ñ–µ–π—Å –¥–ª—è —Ç–µ—Å—Ç—É–≤–∞–Ω–Ω—è –≤—Å—ñ—Ö —Ñ—É–Ω–∫—Ü—ñ–π:
- –†–µ—î—Å—Ç—Ä–∞—Ü—ñ—è —Ç–∞ –≤—Ö—ñ–¥ –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á—ñ–≤
- –ó–º—ñ–Ω–∞ —Ç–µ–º–∏ –æ—Ñ–æ—Ä–º–ª–µ–Ω–Ω—è
- –î–æ—Å—Ç—É–ø –¥–æ –∑–∞—Ö–∏—â–µ–Ω–∏—Ö –º–∞—Ä—à—Ä—É—Ç—ñ–≤
- –ü–µ—Ä–µ–≤—ñ—Ä–∫–∞ —Å—Ç–∞—Ç—É—Å—É –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü—ñ—ó

### –¢–µ—Å—Ç—É–≤–∞–Ω–Ω—è —á–µ—Ä–µ–∑ curl

#### 1. –†–µ—î—Å—Ç—Ä–∞—Ü—ñ—è –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–∞
```bash
curl -X POST http://localhost:3000/register \
  -H "Content-Type: application/json" \
  -d '{"username": "testuser", "password": "pass123", "email": "test@example.com"}'
```

#### 2. –í—Ö—ñ–¥
```bash
curl -X POST http://localhost:3000/login \
  -H "Content-Type: application/json" \
  -d '{"username": "testuser", "password": "pass123"}' \
  -c cookies.txt
```

#### 3. –í—Å—Ç–∞–Ω–æ–≤–∏—Ç–∏ —Ç–µ–º—É
```bash
curl -X POST http://localhost:3000/set-theme \
  -H "Content-Type: application/json" \
  -d '{"theme": "dark"}' \
  -b cookies.txt
```

#### 4. –û—Ç—Ä–∏–º–∞—Ç–∏ –ø—Ä–æ—Ñ—ñ–ª—å (–∑–∞—Ö–∏—â–µ–Ω–∏–π –º–∞—Ä—à—Ä—É—Ç)
```bash
curl http://localhost:3000/profile -b cookies.txt
```

#### 5. –í–∏—Ö—ñ–¥
```bash
curl -X POST http://localhost:3000/logout -b cookies.txt
```

## üìÅ –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –ø—Ä–æ–µ–∫—Ç—É

```
61.express_pug/
‚îú‚îÄ‚îÄ index.js                    # –ì–æ–ª–æ–≤–Ω–∏–π —Ñ–∞–π–ª —Å–µ—Ä–≤–µ—Ä–∞
‚îú‚îÄ‚îÄ package.json               # –ó–∞–ª–µ–∂–Ω–æ—Å—Ç—ñ
‚îú‚îÄ‚îÄ API_DOCUMENTATION.md       # –î–µ—Ç–∞–ª—å–Ω–∞ –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü—ñ—è API
‚îú‚îÄ‚îÄ README.md                  # –¶–µ–π —Ñ–∞–π–ª
‚îú‚îÄ‚îÄ public/                    # –°—Ç–∞—Ç–∏—á–Ω—ñ —Ñ–∞–π–ª–∏
‚îÇ   ‚îú‚îÄ‚îÄ test.html             # –í–µ–±-—ñ–Ω—Ç–µ—Ä—Ñ–µ–π—Å –¥–ª—è —Ç–µ—Å—Ç—É–≤–∞–Ω–Ω—è
‚îÇ   ‚îî‚îÄ‚îÄ img/
‚îÇ       ‚îî‚îÄ‚îÄ favicon.ico       # Favicon
‚îî‚îÄ‚îÄ src/
    ‚îú‚îÄ‚îÄ pug/                  # PUG —à–∞–±–ª–æ–Ω–∏
    ‚îÇ   ‚îú‚îÄ‚îÄ users.pug
    ‚îÇ   ‚îî‚îÄ‚îÄ user.pug
    ‚îî‚îÄ‚îÄ ejs/                  # EJS —à–∞–±–ª–æ–Ω–∏
        ‚îú‚îÄ‚îÄ articles.ejs
        ‚îî‚îÄ‚îÄ article.ejs
```

## üîß –¢–µ—Ö–Ω–æ–ª–æ–≥—ñ—ó

- **Express.js** v5.1.0 - Web framework
- **PUG** v3.0.3 - –®–∞–±–ª–æ–Ω—ñ–∑–∞—Ç–æ—Ä
- **EJS** v3.1.10 - –®–∞–±–ª–æ–Ω—ñ–∑–∞—Ç–æ—Ä
- **cookie-parser** - Middleware –¥–ª—è —Ä–æ–±–æ—Ç–∏ –∑ cookies
- **jsonwebtoken** v9.0.2 - JWT —Ç–æ–∫–µ–Ω–∏
- **joi** v18.0.1 - –í–∞–ª—ñ–¥–∞—Ü—ñ—è (–≤—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–æ)

## üîí –ë–µ–∑–ø–µ–∫–∞

### ‚ö†Ô∏è –í–ê–ñ–õ–ò–í–û –¥–ª—è –ø—Ä–æ–¥–∞–∫—à–µ–Ω—É:

1. **JWT Secret**: –ó–º—ñ–Ω—ñ—Ç—å `JWT_SECRET` –Ω–∞ –±–µ–∑–ø–µ—á–Ω–∏–π –∫–ª—é—á
   ```javascript
   const JWT_SECRET = process.env.JWT_SECRET || "fallback-secret";
   ```

2. **–•–µ—à—É–≤–∞–Ω–Ω—è –ø–∞—Ä–æ–ª—ñ–≤**: –í–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–π—Ç–µ bcrypt
   ```bash
   npm install bcrypt
   ```
   ```javascript
   const bcrypt = require('bcrypt');
   const hashedPassword = await bcrypt.hash(password, 10);
   ```

3. **HTTPS**: –£–≤—ñ–º–∫–Ω—ñ—Ç—å `secure: true` –¥–ª—è cookies
   ```javascript
   res.cookie("authToken", token, {
     httpOnly: true,
     secure: true,  // –¢—ñ–ª—å–∫–∏ —á–µ—Ä–µ–∑ HTTPS
     sameSite: "strict"
   });
   ```

4. **–ë–∞–∑–∞ –¥–∞–Ω–∏—Ö**: –ó–∞–º—ñ–Ω—ñ—Ç—å –º–∞—Å–∏–≤–∏ –≤ –ø–∞–º'—è—Ç—ñ –Ω–∞ —Ä–µ–∞–ª—å–Ω—É –ë–î (MongoDB, PostgreSQL, etc.)

5. **Rate Limiting**: –î–æ–¥–∞–π—Ç–µ –æ–±–º–µ–∂–µ–Ω–Ω—è –∫—ñ–ª—å–∫–æ—Å—Ç—ñ –∑–∞–ø–∏—Ç—ñ–≤
   ```bash
   npm install express-rate-limit
   ```

6. **–í–∞–ª—ñ–¥–∞—Ü—ñ—è**: –í–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–π—Ç–µ Joi –¥–ª—è –≤–∞–ª—ñ–¥–∞—Ü—ñ—ó –≤—Ö—ñ–¥–Ω–∏—Ö –¥–∞–Ω–∏—Ö

## üìö –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü—ñ—è

–î–µ—Ç–∞–ª—å–Ω—É –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü—ñ—é API –¥–∏–≤—ñ—Ç—å—Å—è —É —Ñ–∞–π–ª—ñ `API_DOCUMENTATION.md`

## üéØ –ü—Ä–∏–∫–ª–∞–¥–∏ –≤–∏–∫–æ—Ä–∏—Å—Ç–∞–Ω–Ω—è

### JavaScript –Ω–∞ –∫–ª—ñ—î–Ω—Ç—ñ
```javascript
// –†–µ—î—Å—Ç—Ä–∞—Ü—ñ—è
const response = await fetch('/register', {
  method: 'POST',
  headers: { 'Content-Type': 'application/json' },
  body: JSON.stringify({
    username: 'john',
    password: 'secret',
    email: 'john@example.com'
  })
});

// –í—Ö—ñ–¥
await fetch('/login', {
  method: 'POST',
  headers: { 'Content-Type': 'application/json' },
  body: JSON.stringify({ username: 'john', password: 'secret' }),
  credentials: 'include' // –í–∞–∂–ª–∏–≤–æ –¥–ª—è cookies
});

// –í—Å—Ç–∞–Ω–æ–≤–∏—Ç–∏ —Ç–µ–º—É
await fetch('/set-theme', {
  method: 'POST',
  headers: { 'Content-Type': 'application/json' },
  body: JSON.stringify({ theme: 'dark' }),
  credentials: 'include'
});

// –û—Ç—Ä–∏–º–∞—Ç–∏ –ø—Ä–æ—Ñ—ñ–ª—å
const profile = await fetch('/profile', {
  credentials: 'include'
});
```

## üêõ –í—ñ–¥–æ–º—ñ –æ–±–º–µ–∂–µ–Ω–Ω—è

1. –ö–æ—Ä–∏—Å—Ç—É–≤–∞—á—ñ –∑–±–µ—Ä—ñ–≥–∞—é—Ç—å—Å—è –≤ –ø–∞–º'—è—Ç—ñ (–≤—Ç—Ä–∞—á–∞—é—Ç—å—Å—è –ø—Ä–∏ –ø–µ—Ä–µ–∑–∞–ø—É—Å–∫—É)
2. –ü–∞—Ä–æ–ª—ñ –Ω–µ —Ö–µ—à—É—é—Ç—å—Å—è (—Ç—ñ–ª—å–∫–∏ –¥–ª—è –¥–µ–º–æ–Ω—Å—Ç—Ä–∞—Ü—ñ—ó)
3. –ù–µ–º–∞—î –≤–∞–ª—ñ–¥–∞—Ü—ñ—ó email —Ñ–æ—Ä–º–∞—Ç—É
4. –ù–µ–º–∞—î rate limiting
5. –ù–µ–º–∞—î –ª–æ–≥—É–≤–∞–Ω–Ω—è

## üìù TODO –¥–ª—è –ø–æ–∫—Ä–∞—â–µ–Ω–Ω—è

- [ ] –ü—ñ–¥–∫–ª—é—á–∏—Ç–∏ –±–∞–∑—É –¥–∞–Ω–∏—Ö (MongoDB/PostgreSQL)
- [ ] –î–æ–¥–∞—Ç–∏ bcrypt –¥–ª—è —Ö–µ—à—É–≤–∞–Ω–Ω—è –ø–∞—Ä–æ–ª—ñ–≤
- [ ] –†–µ–∞–ª—ñ–∑—É–≤–∞—Ç–∏ –≤–∞–ª—ñ–¥–∞—Ü—ñ—é —á–µ—Ä–µ–∑ Joi
- [ ] –î–æ–¥–∞—Ç–∏ rate limiting
- [ ] –î–æ–¥–∞—Ç–∏ –ª–æ–≥—É–≤–∞–Ω–Ω—è (Winston/Morgan)
- [ ] –î–æ–¥–∞—Ç–∏ —Ç–µ—Å—Ç–∏ (Jest/Mocha)
- [ ] –î–æ–¥–∞—Ç–∏ CORS –Ω–∞–ª–∞—à—Ç—É–≤–∞–Ω–Ω—è
- [ ] –°—Ç–≤–æ—Ä–∏—Ç–∏ frontend –∑ React/Vue
- [ ] –î–æ–¥–∞—Ç–∏ refresh tokens
- [ ] –†–µ–∞–ª—ñ–∑—É–≤–∞—Ç–∏ –≤—ñ–¥–Ω–æ–≤–ª–µ–Ω–Ω—è –ø–∞—Ä–æ–ª—é

## üìû –ü—ñ–¥—Ç—Ä–∏–º–∫–∞

–î–ª—è –ø–∏—Ç–∞–Ω—å —Ç–∞ –ø—Ä–æ–ø–æ–∑–∏—Ü—ñ–π —Å—Ç–≤–æ—Ä—ñ—Ç—å issue —É —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä—ñ—ó –ø—Ä–æ–µ–∫—Ç—É.

---

**–ê–≤—Ç–æ—Ä:** –í–∞—à–µ —ñ–º'—è  
**–í–µ—Ä—Å—ñ—è:** 1.0.0  
**–õ—ñ—Ü–µ–Ω–∑—ñ—è:** ISC
